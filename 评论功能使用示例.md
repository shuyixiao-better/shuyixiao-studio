# è¯„è®ºåŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

## è‡ªåŠ¨é›†æˆï¼ˆæ¨èï¼‰

è¯„è®ºç»„ä»¶å·²ç»è‡ªåŠ¨é›†æˆåˆ°æ‰€æœ‰æ–‡ç« é¡µé¢åº•éƒ¨ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ã€‚

è®¿é—®ä»»æ„æ–‡ç« ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨å³å¯çœ‹åˆ°è¯„è®ºåŒºã€‚

## æ‰‹åŠ¨æ·»åŠ ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³åœ¨ç‰¹å®šä½ç½®æ·»åŠ è¯„è®ºç»„ä»¶ï¼Œå¯ä»¥åœ¨ Markdown æ–‡ä»¶ä¸­ä½¿ç”¨ï¼š

```markdown
# æ–‡ç« æ ‡é¢˜

æ–‡ç« å†…å®¹...

## è¯„è®ºåŒº

<Comments />
```

## ç¦ç”¨è¯„è®º

å¦‚æœæŸç¯‡æ–‡ç« ä¸æƒ³æ˜¾ç¤ºè¯„è®ºï¼Œå¯ä»¥åœ¨ frontmatter ä¸­é…ç½®ï¼š

```markdown
---
title: æ–‡ç« æ ‡é¢˜
comments: false
---

# æ–‡ç« å†…å®¹
```

ç„¶åä¿®æ”¹ `docs/.vitepress/theme/index.js`ï¼š

```javascript
Layout() {
  const route = useRoute();
  
  return h(DefaultTheme.Layout, null, {
    'doc-after': () => {
      // æ£€æŸ¥ frontmatter æ˜¯å¦ç¦ç”¨è¯„è®º
      if (route.data?.frontmatter?.comments === false) {
        return null;
      }
      return isNetlify ? h(Comments) : h(CommentsPlaceholder);
    }
  })
}
```

## è‡ªå®šä¹‰æ ·å¼

### ä¿®æ”¹è¯„è®ºåŒºæ ‡é¢˜

ç¼–è¾‘ `Comments.vue`ï¼š

```vue
<h2 class="comments-title">ğŸ’¬ è¯„è®ºåŒº</h2>
<!-- æ”¹ä¸º -->
<h2 class="comments-title">ğŸ“ ç•™è¨€æ¿</h2>
```

### ä¿®æ”¹ä¸»é¢˜è‰²

ç¼–è¾‘ `Comments.vue` çš„ `<style>` éƒ¨åˆ†ï¼š

```css
.submit-btn {
  background: var(--vp-c-brand); /* ä½¿ç”¨ä¸»é¢˜è‰² */
  /* æˆ–ä½¿ç”¨è‡ªå®šä¹‰é¢œè‰² */
  background: #42b883; /* ç»¿è‰² */
}
```

### ä¿®æ”¹å¸ƒå±€

```css
.comments-section {
  margin-top: 60px;  /* è°ƒæ•´ä¸Šè¾¹è· */
  padding: 30px;     /* è°ƒæ•´å†…è¾¹è· */
  border-radius: 12px; /* è°ƒæ•´åœ†è§’ */
}
```

## ç¯å¢ƒæ£€æµ‹

è¯„è®ºç»„ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹éƒ¨ç½²ç¯å¢ƒï¼š

```javascript
// Netlify ç¯å¢ƒ - æ˜¾ç¤ºå®Œæ•´è¯„è®ºåŠŸèƒ½
if (hostname.includes('netlify') || hostname === 'www.poeticcoder.com') {
  return <Comments />
}

// GitHub Pages ç¯å¢ƒ - æ˜¾ç¤ºå ä½æç¤º
return <CommentsPlaceholder />
```

## API ä½¿ç”¨

### è·å–è¯„è®ºåˆ—è¡¨

```javascript
const response = await fetch(
  `/.netlify/functions/comments?path=${articlePath}`
);
const data = await response.json();
console.log(data.comments);
```

### å‘è¡¨è¯„è®º

```javascript
const response = await fetch('/.netlify/functions/comments', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    path: '/articles/example',
    author: 'å¼ ä¸‰',
    content: 'å¾ˆæ£’çš„æ–‡ç« ï¼',
    images: ['data:image/png;base64,...']
  })
});
```

### åˆ é™¤è¯„è®º

```javascript
const response = await fetch('/.netlify/functions/comments', {
  method: 'DELETE',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    path: '/articles/example',
    commentId: '1234567890',
    password: 'admin-password'
  })
});
```

## æ•°æ®ç»“æ„

### è¯„è®ºå¯¹è±¡

```typescript
interface Comment {
  id: string;              // æ—¶é—´æˆ³å­—ç¬¦ä¸²
  author: string;          // è¯„è®ºè€…æ˜µç§°
  content: string;         // è¯„è®ºå†…å®¹
  images: string[];        // Base64 å›¾ç‰‡æ•°ç»„
  timestamp: string;       // ISO 8601 æ—¶é—´å­—ç¬¦ä¸²
}
```

### å­˜å‚¨ç»“æ„

```json
{
  "/articles/example": [
    {
      "id": "1699876543210",
      "author": "å¼ ä¸‰",
      "content": "å¾ˆæ£’çš„æ–‡ç« ï¼",
      "images": [],
      "timestamp": "2025-11-13T10:30:00.000Z"
    }
  ]
}
```

## äº‹ä»¶ç›‘å¬

### è¯„è®ºå‘è¡¨æˆåŠŸ

```javascript
// åœ¨ Comments.vue ä¸­æ·»åŠ 
const emit = defineEmits(['comment-posted']);

const submitComment = async () => {
  // ... æäº¤é€»è¾‘
  if (data.success) {
    emit('comment-posted', data.comment);
  }
};
```

### è¯„è®ºåˆ é™¤æˆåŠŸ

```javascript
const emit = defineEmits(['comment-deleted']);

const deleteComment = async (commentId) => {
  // ... åˆ é™¤é€»è¾‘
  if (data.success) {
    emit('comment-deleted', commentId);
  }
};
```

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰é‚®ä»¶æ¨¡æ¿

ç¼–è¾‘ `netlify/functions/comments.mjs`ï¼š

```javascript
const mailOptions = {
  from: process.env.SMTP_USER,
  to: process.env.ADMIN_EMAIL,
  subject: `æ–°è¯„è®ºé€šçŸ¥ - ${articlePath}`,
  html: `
    <!-- è‡ªå®šä¹‰ HTML æ¨¡æ¿ -->
    <div style="font-family: Arial, sans-serif;">
      <h2>æ–°è¯„è®ºé€šçŸ¥</h2>
      <p>æ–‡ç« ï¼š${articlePath}</p>
      <p>è¯„è®ºè€…ï¼š${comment.author}</p>
      <p>å†…å®¹ï¼š${comment.content}</p>
    </div>
  `
};
```

### æ·»åŠ è¯„è®ºå®¡æ ¸

```javascript
// åœ¨ comments.mjs ä¸­æ·»åŠ 
const newComment = {
  id: Date.now().toString(),
  author: author.trim(),
  content: content.trim(),
  images: images,
  timestamp: new Date().toISOString(),
  approved: false  // æ·»åŠ å®¡æ ¸çŠ¶æ€
};

// å‰ç«¯åªæ˜¾ç¤ºå·²å®¡æ ¸çš„è¯„è®º
const approvedComments = comments.filter(c => c.approved);
```

### æ·»åŠ è¯„è®ºç»Ÿè®¡

```javascript
// åœ¨ Comments.vue ä¸­æ·»åŠ 
const commentCount = computed(() => comments.value.length);

// åœ¨æ¨¡æ¿ä¸­æ˜¾ç¤º
<h2 class="comments-title">
  ğŸ’¬ è¯„è®ºåŒº ({{ commentCount }})
</h2>
```

## æ€§èƒ½ä¼˜åŒ–

### è¯„è®ºåˆ†é¡µ

```javascript
const pageSize = 10;
const currentPage = ref(1);

const paginatedComments = computed(() => {
  const start = (currentPage.value - 1) * pageSize;
  const end = start + pageSize;
  return comments.value.slice(start, end);
});
```

### å›¾ç‰‡æ‡’åŠ è½½

```vue
<img 
  :src="img" 
  loading="lazy"
  class="comment-image"
/>
```

### é˜²æŠ–æäº¤

```javascript
import { debounce } from 'lodash-es';

const submitComment = debounce(async () => {
  // æäº¤é€»è¾‘
}, 1000);
```

## å®‰å…¨å¢å¼º

### æ·»åŠ éªŒè¯ç 

```javascript
// ä½¿ç”¨ Google reCAPTCHA
const verifyRecaptcha = async (token) => {
  const response = await fetch('/api/verify-recaptcha', {
    method: 'POST',
    body: JSON.stringify({ token })
  });
  return response.json();
};
```

### IP é™æµ

```javascript
// åœ¨ comments.mjs ä¸­æ·»åŠ 
const rateLimiter = new Map();

const checkRateLimit = (ip) => {
  const now = Date.now();
  const lastRequest = rateLimiter.get(ip);
  
  if (lastRequest && now - lastRequest < 60000) {
    return false; // 1åˆ†é’Ÿå†…åªèƒ½è¯„è®ºä¸€æ¬¡
  }
  
  rateLimiter.set(ip, now);
  return true;
};
```

### æ•æ„Ÿè¯è¿‡æ»¤

```javascript
const sensitiveWords = ['æ•æ„Ÿè¯1', 'æ•æ„Ÿè¯2'];

const filterContent = (content) => {
  let filtered = content;
  sensitiveWords.forEach(word => {
    filtered = filtered.replace(new RegExp(word, 'gi'), '***');
  });
  return filtered;
};
```

## é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡

### é›†æˆ Akismetï¼ˆåƒåœ¾è¯„è®ºæ£€æµ‹ï¼‰

```javascript
import akismet from 'akismet-api';

const client = akismet.client({
  key: process.env.AKISMET_KEY,
  blog: 'https://www.poeticcoder.com'
});

const isSpam = await client.checkSpam({
  user_ip: req.headers['x-forwarded-for'],
  user_agent: req.headers['user-agent'],
  comment_content: content,
  comment_author: author
});
```

### é›†æˆ Gravatarï¼ˆå¤´åƒï¼‰

```vue
<template>
  <img 
    :src="getGravatar(comment.email)" 
    class="comment-avatar"
  />
</template>

<script>
import md5 from 'md5';

const getGravatar = (email) => {
  const hash = md5(email.toLowerCase().trim());
  return `https://www.gravatar.com/avatar/${hash}?d=identicon`;
};
</script>
```

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ API è¯·æ±‚

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°
fetch('/.netlify/functions/comments?path=/articles/example')
  .then(r => r.json())
  .then(console.log);
```

### æŸ¥çœ‹ Blobs æ•°æ®

```bash
# ä½¿ç”¨ Netlify CLI
netlify blobs:list comments
netlify blobs:get comments "/articles/example"
```

### æœ¬åœ°è°ƒè¯•

```javascript
// åœ¨ Comments.vue ä¸­æ·»åŠ 
onMounted(() => {
  if (import.meta.env.DEV) {
    console.log('è¯„è®ºç»„ä»¶å·²æŒ‚è½½');
    console.log('å½“å‰è·¯å¾„:', getArticlePath());
  }
});
```

## ç›¸å…³èµ„æº

- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [VitePress æ–‡æ¡£](https://vitepress.dev/)
- [Netlify Functions æ–‡æ¡£](https://docs.netlify.com/functions/overview/)
- [Netlify Blobs æ–‡æ¡£](https://docs.netlify.com/blobs/overview/)
- [Nodemailer æ–‡æ¡£](https://nodemailer.com/)

## æ€»ç»“

è¯„è®ºåŠŸèƒ½å·²å®Œæ•´é›†æˆï¼Œæ”¯æŒè‡ªåŠ¨æ˜¾ç¤ºå’Œæ‰‹åŠ¨é…ç½®ã€‚ä½ å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰å’Œæ‰©å±•ã€‚

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š
- [è¯„è®ºåŠŸèƒ½å¿«é€Ÿå¯åŠ¨.md](./è¯„è®ºåŠŸèƒ½å¿«é€Ÿå¯åŠ¨.md)
- [è¯„è®ºåŠŸèƒ½é…ç½®æŒ‡å—.md](./è¯„è®ºåŠŸèƒ½é…ç½®æŒ‡å—.md)
- [è¯„è®ºåŠŸèƒ½å®ç°æ€»ç»“.md](./è¯„è®ºåŠŸèƒ½å®ç°æ€»ç»“.md)
