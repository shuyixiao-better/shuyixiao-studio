# Mermaid å›¾è¡¨æ¸²æŸ“é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ‰ é—®é¢˜å·²è§£å†³ï¼ˆ2025å¹´1æœˆæ›´æ–°ï¼‰

é¡¹ç›®å·²å‡çº§ä½¿ç”¨å®˜æ–¹ `vitepress-plugin-mermaid` æ’ä»¶ï¼Œä¹‹å‰çš„æ¸²æŸ“é—®é¢˜å·²å…¨éƒ¨è§£å†³ï¼

## æ–°ç‰ˆæœ¬é…ç½®

### å·²å®Œæˆçš„å‡çº§

âœ… VitePress å‡çº§åˆ°æœ€æ–°ç¨³å®šç‰ˆ  
âœ… ä½¿ç”¨å®˜æ–¹ `vitepress-plugin-mermaid` æ’ä»¶  
âœ… Mermaid ç‰ˆæœ¬å‡çº§åˆ° 11.12.0  
âœ… ç§»é™¤äº†å¤æ‚çš„æ‰‹åŠ¨åˆå§‹åŒ–ä»£ç   
âœ… ä½¿ç”¨æœ¬åœ°åŒ…è€Œä¸æ˜¯ CDN  

### å½“å‰é…ç½®æ–‡ä»¶

1. **package.json** - ä¾èµ–é…ç½®
2. **.vitepress/config.js** - VitePress å’Œ Mermaid é…ç½®
3. **.vitepress/theme/index.js** - ç®€åŒ–çš„ä¸»é¢˜é…ç½®
4. **.vitepress/theme/mermaid.css** - æ ·å¼æ–‡ä»¶

## å¿«é€Ÿå¯åŠ¨

```bash
# 1. ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Node ç‰ˆæœ¬
nvm use 22.16.0

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæ˜¯é¦–æ¬¡ä½¿ç”¨ï¼‰
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run docs:dev
```

è®¿é—®: http://localhost:5173/articles/microservice-communication

## æµè§ˆå™¨è°ƒè¯•æ­¥éª¤

å¦‚æœå›¾è¡¨ä»ç„¶æ— æ³•æ˜¾ç¤ºï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

### 1. æ‰“å¼€å¼€å‘è€…å·¥å…·

- Windows/Linux: `F12` æˆ– `Ctrl+Shift+I`
- Mac: `Cmd+Option+I`

### 2. æ£€æŸ¥ Console æ ‡ç­¾

**æ­£å¸¸æƒ…å†µ**åº”è¯¥çœ‹åˆ°ï¼š
- VitePress ç›¸å…³çš„å¯åŠ¨ä¿¡æ¯
- æ²¡æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯

**å¦‚æœæœ‰é”™è¯¯**ï¼š
```javascript
// å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

// é”™è¯¯: "Cannot find module 'vitepress-plugin-mermaid'"
// è§£å†³: npm install

// é”™è¯¯: "withMermaid is not a function"
// è§£å†³: æ£€æŸ¥ .vitepress/config.js çš„å¯¼å…¥è¯­å¥

// é”™è¯¯: "Mermaid syntax error"
// è§£å†³: åœ¨ https://mermaid.live/ éªŒè¯ Mermaid è¯­æ³•
```

### 3. æ£€æŸ¥ Elements æ ‡ç­¾

æŸ¥çœ‹é¡µé¢ HTML ç»“æ„ï¼š

```html
<!-- æ­£ç¡®çš„æ¸²æŸ“ç»“æœ -->
<div class="mermaid-wrapper">
  <svg>
    <!-- Mermaid ç”Ÿæˆçš„ SVG å†…å®¹ -->
  </svg>
</div>

<!-- å¦‚æœçœ‹åˆ°è¿™ä¸ªï¼Œè¯´æ˜æ²¡æœ‰æ¸²æŸ“ -->
<pre><code class="language-mermaid">
  graph TB
  ...
</code></pre>
```

### 4. æ£€æŸ¥ Network æ ‡ç­¾

ç¡®è®¤èµ„æºåŠ è½½ï¼š
- æ‰€æœ‰ JavaScript æ–‡ä»¶åº”è¯¥è¿”å› 200 çŠ¶æ€ç 
- ä¸åº”è¯¥æœ‰ 404 æˆ– 500 é”™è¯¯

## å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1: å›¾è¡¨æ˜¾ç¤ºä¸ºä»£ç å—

**ç°è±¡**: Mermaid ä»£ç æ˜¾ç¤ºä¸ºæ™®é€šä»£ç ï¼Œæ²¡æœ‰æ¸²æŸ“æˆå›¾è¡¨

**åŸå› **: 
- VitePress é…ç½®ä¸æ­£ç¡®
- æ’ä»¶æœªæ­£ç¡®å¯¼å…¥

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ `.vitepress/config.js` æ˜¯å¦æ­£ç¡®é…ç½®ï¼š

```javascript
import { withMermaid } from 'vitepress-plugin-mermaid'

export default withMermaid(
  defineConfig({
    // ... é…ç½®
  })
)
```

2. ç¡®ä¿ä¾èµ–å·²å®‰è£…ï¼š
```bash
npm install -D vitepress-plugin-mermaid mermaid
```

3. é‡å¯å¼€å‘æœåŠ¡å™¨

### é—®é¢˜ 2: é¡µé¢åŠ è½½åå›¾è¡¨ä¸æ˜¾ç¤º

**ç°è±¡**: é¡µé¢æ­£å¸¸åŠ è½½ï¼Œä½† Mermaid å›¾è¡¨ä½ç½®æ˜¯ç©ºç™½

**è§£å†³æ–¹æ¡ˆ**:

1. ç¡¬åˆ·æ–°æµè§ˆå™¨: `Ctrl+Shift+R` (Windows/Linux) æˆ– `Cmd+Shift+R` (Mac)
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
4. å°è¯•ä¸åŒçš„æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariï¼‰

### é—®é¢˜ 3: éƒ¨åˆ†å›¾è¡¨æ¸²æŸ“å¤±è´¥

**ç°è±¡**: æŸäº› Mermaid å›¾è¡¨æ­£å¸¸ï¼ŒæŸäº›æ˜¾ç¤ºé”™è¯¯

**åŸå› **: Mermaid è¯­æ³•é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:

1. åœ¨ [Mermaid Live Editor](https://mermaid.live/) ä¸­éªŒè¯è¯­æ³•
2. æ£€æŸ¥ä¸­æ–‡å­—ç¬¦æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿æ²¡æœ‰ç‰¹æ®Šå­—ç¬¦å¹²æ‰°
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 4: Node ç‰ˆæœ¬é”™è¯¯

**ç°è±¡**: å¯åŠ¨æ—¶æŠ¥é”™æˆ–æ„å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥å½“å‰ Node ç‰ˆæœ¬
node --version

# åº”è¯¥æ˜¾ç¤º: v22.16.0 æˆ–æ›´é«˜

# å¦‚æœä¸æ˜¯ï¼Œåˆ‡æ¢ç‰ˆæœ¬
nvm use 22.16.0

# å¦‚æœæ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬ï¼Œå®‰è£…å®ƒ
nvm install 22.16.0
```

### é—®é¢˜ 5: ç«¯å£è¢«å ç”¨

**ç°è±¡**: 
```
Port 5173 is already in use
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ–¹æ¡ˆ 1: ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
# Mac/Linux
lsof -ti:5173 | xargs kill -9

# Windows
netstat -ano | findstr :5173
taskkill /PID <è¿›ç¨‹ID> /F

# æ–¹æ¡ˆ 2: ä½¿ç”¨ä¸åŒç«¯å£
npm run docs:dev -- --port 5174
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‡å°‘å›¾è¡¨å¤æ‚åº¦

å¦‚æœå›¾è¡¨æ¸²æŸ“å¾ˆæ…¢ï¼š
- ç®€åŒ–èŠ‚ç‚¹æ•°é‡
- å‡å°‘è¿æ¥çº¿æ•°é‡
- é¿å…è¿‡åº¦åµŒå¥—

### 2. ä½¿ç”¨ CDNï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

æ„å»ºç”Ÿäº§ç‰ˆæœ¬æ—¶ï¼ŒMermaid ä¼šè‡ªåŠ¨ä¼˜åŒ–ã€‚

```bash
npm run docs:build
```

## å¯¹æ¯”ï¼šæ–°æ—§é…ç½®

### æ—§é…ç½®ï¼ˆå·²åºŸå¼ƒï¼‰âŒ

- ä½¿ç”¨ CDN åŠ è½½ Mermaid
- æ‰‹åŠ¨ç¼–å†™åˆå§‹åŒ–ä»£ç 
- è½®è¯¢æ£€æŸ¥ Mermaid æ˜¯å¦åŠ è½½
- æ‰‹åŠ¨æ¸²æŸ“æ¯ä¸ªå›¾è¡¨
- é…ç½®å¤æ‚ï¼Œæ˜“å‡ºé”™

### æ–°é…ç½®ï¼ˆæ¨èï¼‰âœ…

- ä½¿ç”¨å®˜æ–¹æ’ä»¶
- è‡ªåŠ¨åˆå§‹åŒ–
- æœ¬åœ°åŒ…ç®¡ç†
- è‡ªåŠ¨æ¸²æŸ“
- é…ç½®ç®€å•ï¼Œç¨³å®šå¯é 

## æ‰‹åŠ¨æµ‹è¯•

åœ¨æµè§ˆå™¨ Console ä¸­æµ‹è¯• Mermaid æ˜¯å¦å¯ç”¨ï¼š

```javascript
// æ£€æŸ¥ Mermaid ç‰ˆæœ¬
console.log('Mermaid version:', window.mermaid?.version)

// æ‰‹åŠ¨æ¸²æŸ“æµ‹è¯•ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
if (window.mermaid) {
  const code = `graph TD
    A[æµ‹è¯•] --> B[æˆåŠŸ]`
  
  window.mermaid.render('test-id', code).then(result => {
    console.log('âœ… Mermaid æ¸²æŸ“æˆåŠŸï¼')
    console.log(result.svg.substring(0, 100))
  }).catch(error => {
    console.error('âŒ Mermaid æ¸²æŸ“å¤±è´¥:', error)
  })
} else {
  console.error('âŒ Mermaid æœªåŠ è½½')
}
```

## è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç¯å¢ƒä¿¡æ¯**:
   ```bash
   node --version
   npm --version
   ```

2. **æµè§ˆå™¨ä¿¡æ¯**: 
   - æµè§ˆå™¨åç§°å’Œç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿ

3. **é”™è¯¯ä¿¡æ¯**:
   - å®Œæ•´çš„æ§åˆ¶å°é”™è¯¯æ—¥å¿—
   - æˆªå›¾

4. **Mermaid ä»£ç **:
   - æ— æ³•æ¸²æŸ“çš„ Mermaid ä»£ç ç¤ºä¾‹

5. **é…ç½®æ–‡ä»¶**:
   - `.vitepress/config.js` å†…å®¹
   - `package.json` ä¾èµ–åˆ—è¡¨

## å‚è€ƒèµ„æº

- [VitePress å®˜æ–¹æ–‡æ¡£](https://vitepress.dev/)
- [VitePress Plugin Mermaid](https://github.com/emersonbottero/vitepress-plugin-mermaid)
- [Mermaid å®˜æ–¹æ–‡æ¡£](https://mermaid.js.org/)
- [Mermaid åœ¨çº¿ç¼–è¾‘å™¨](https://mermaid.live/)

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ  
**é…ç½®çŠ¶æ€**: âœ… å·²ä¼˜åŒ–å®Œæˆ
