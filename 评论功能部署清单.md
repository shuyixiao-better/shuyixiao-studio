# 评论功能部署清单

## 📋 部署前检查

### 1. 代码文件检查

- [ ] `netlify/functions/comments.mjs` - 评论 API 函数
- [ ] `docs/.vitepress/theme/components/Comments.vue` - 评论组件
- [ ] `docs/.vitepress/theme/components/CommentsPlaceholder.vue` - 占位组件
- [ ] `docs/.vitepress/theme/index.js` - 主题配置已更新
- [ ] `.env.example` - 环境变量示例已更新

### 2. 依赖检查

```bash
# 检查 package.json 中的依赖
- [ ] @netlify/blobs (已安装)
- [ ] @netlify/functions (已安装)
- [ ] nodemailer (已安装)
```

### 3. 本地测试

```bash
# 启动本地开发服务器
pnpm docs:dev:netlify

# 测试清单
- [ ] 评论列表正常加载
- [ ] 可以发表文字评论
- [ ] 可以上传图片
- [ ] 可以删除评论（正确密码）
- [ ] 邮件通知正常发送
- [ ] 移动端显示正常
```

## 🚀 Netlify 部署步骤

### 步骤 1: 配置环境变量

登录 [Netlify](https://app.netlify.com/)，进入站点设置：

```
Site settings → Environment variables → Add a variable
```

添加以下环境变量：

```bash
# SMTP 邮件配置
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_USER=your-email@163.com
SMTP_PASS=your-authorization-password

# 评论功能配置
ADMIN_EMAIL=your-email@163.com
ADMIN_PASSWORD=your-strong-password
```

**检查清单**:
- [ ] SMTP_HOST 已配置
- [ ] SMTP_PORT 已配置
- [ ] SMTP_USER 已配置
- [ ] SMTP_PASS 已配置（授权密码，不是登录密码）
- [ ] ADMIN_EMAIL 已配置
- [ ] ADMIN_PASSWORD 已配置（强密码）

### 步骤 2: 推送代码

```bash
# 提交代码
git add .
git commit -m "feat: 添加评论功能"
git push origin main
```

**检查清单**:
- [ ] 所有新文件已添加
- [ ] 代码已提交
- [ ] 代码已推送到远程仓库

### 步骤 3: 触发部署

在 Netlify 后台：

```
Deploys → Trigger deploy → Deploy site
```

**检查清单**:
- [ ] 部署已触发
- [ ] 构建日志无错误
- [ ] 部署成功完成

### 步骤 4: 验证部署

访问你的 Netlify 站点：

```
https://your-site.netlify.app
```

**检查清单**:
- [ ] 网站可以正常访问
- [ ] 文章页面底部显示评论区
- [ ] 评论功能正常工作

## 🧪 部署后测试

### 功能测试

1. **发表评论测试**
   - [ ] 访问任意文章
   - [ ] 填写昵称和评论内容
   - [ ] 点击"发表评论"
   - [ ] 评论成功显示

2. **图片上传测试**
   - [ ] 上传单张图片
   - [ ] 上传多张图片（最多3张）
   - [ ] 图片正确显示
   - [ ] 点击图片可以放大

3. **删除评论测试**
   - [ ] 按住 Shift 键 3 秒
   - [ ] 删除按钮显示
   - [ ] 输入正确密码可以删除
   - [ ] 输入错误密码无法删除

4. **邮件通知测试**
   - [ ] 发表评论后收到邮件
   - [ ] 邮件内容完整
   - [ ] 邮件链接可以跳转

5. **响应式测试**
   - [ ] 桌面端显示正常
   - [ ] 移动端显示正常
   - [ ] 平板端显示正常

### 性能测试

- [ ] 评论列表加载速度 < 2秒
- [ ] 图片上传速度 < 3秒
- [ ] 页面无明显卡顿

### 兼容性测试

- [ ] Chrome 浏览器
- [ ] Firefox 浏览器
- [ ] Safari 浏览器
- [ ] Edge 浏览器
- [ ] 移动端浏览器

## 📊 GitHub Pages 部署步骤

### 步骤 1: 推送代码

```bash
git push origin write
```

**检查清单**:
- [ ] 代码已推送到 write 分支
- [ ] GitHub Actions 自动触发

### 步骤 2: 等待部署

在 GitHub 仓库查看 Actions：

```
Actions → Deploy to GitHub Pages
```

**检查清单**:
- [ ] 构建成功
- [ ] 部署成功

### 步骤 3: 验证部署

访问 GitHub Pages 站点：

```
https://www.poeticcoder.cn
```

**检查清单**:
- [ ] 网站可以正常访问
- [ ] 文章页面底部显示占位提示
- [ ] 点击按钮可以跳转到 Netlify 版本

## 🔍 问题排查

### 问题 1: 评论无法加载

**排查步骤**:
1. [ ] 打开浏览器控制台查看错误
2. [ ] 检查 Network 标签中的 API 请求
3. [ ] 查看 Netlify Functions 日志
4. [ ] 确认环境变量配置正确

**解决方案**:
- 检查 API 路径是否正确
- 确认 Netlify Functions 已部署
- 检查 CORS 配置

### 问题 2: 邮件通知未收到

**排查步骤**:
1. [ ] 检查 ADMIN_EMAIL 配置
2. [ ] 检查 SMTP 配置是否正确
3. [ ] 查看 Netlify Functions 日志
4. [ ] 检查邮箱垃圾箱

**解决方案**:
- 确认 SMTP_PASS 是授权密码
- 检查邮箱设置是否开启 SMTP
- 尝试使用其他邮箱

### 问题 3: 图片上传失败

**排查步骤**:
1. [ ] 检查图片大小是否超过 2MB
2. [ ] 检查图片格式是否支持
3. [ ] 查看浏览器控制台错误
4. [ ] 检查 Netlify Functions 日志

**解决方案**:
- 压缩图片后重试
- 使用支持的图片格式（jpg, png, gif）
- 检查 Base64 编码是否正确

### 问题 4: 删除按钮不显示

**排查步骤**:
1. [ ] 确认按住 Shift 键至少 3 秒
2. [ ] 检查浏览器控制台错误
3. [ ] 刷新页面重试

**解决方案**:
- 确保键盘事件监听正常
- 检查 JavaScript 是否正常加载

## 📝 部署记录

### 部署信息

```
部署时间: _______________
部署人员: _______________
部署环境: Netlify / GitHub Pages
部署版本: _______________
```

### 环境变量配置

```
SMTP_HOST: _______________
SMTP_PORT: _______________
SMTP_USER: _______________
ADMIN_EMAIL: _______________
```

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 发表评论 | ✅ / ❌ | |
| 上传图片 | ✅ / ❌ | |
| 删除评论 | ✅ / ❌ | |
| 邮件通知 | ✅ / ❌ | |
| 响应式设计 | ✅ / ❌ | |

### 发现的问题

1. _______________
2. _______________
3. _______________

### 解决方案

1. _______________
2. _______________
3. _______________

## 🎯 上线后监控

### 第一天

- [ ] 检查评论功能是否正常
- [ ] 检查邮件通知是否正常
- [ ] 查看 Netlify Functions 日志
- [ ] 收集用户反馈

### 第一周

- [ ] 统计评论数量
- [ ] 分析用户使用情况
- [ ] 优化性能问题
- [ ] 修复发现的 Bug

### 第一月

- [ ] 评估功能效果
- [ ] 收集改进建议
- [ ] 规划新功能
- [ ] 优化用户体验

## 📞 紧急联系

### Netlify 支持

- 文档: https://docs.netlify.com/
- 社区: https://answers.netlify.com/
- 状态: https://www.netlifystatus.com/

### 技术支持

- 查看日志: Netlify 后台 → Functions → 日志
- 查看错误: 浏览器控制台 → Console
- 查看网络: 浏览器控制台 → Network

## ✅ 最终确认

部署完成后，确认以下所有项目：

- [ ] 代码已部署到 Netlify
- [ ] 代码已部署到 GitHub Pages
- [ ] 环境变量配置正确
- [ ] 评论功能正常工作
- [ ] 邮件通知正常发送
- [ ] 移动端显示正常
- [ ] 性能测试通过
- [ ] 文档已更新
- [ ] 团队已通知

## 🎉 部署成功

恭喜！评论功能已成功部署。

### 下一步

1. 监控功能使用情况
2. 收集用户反馈
3. 持续优化改进
4. 规划新功能

### 相关文档

- [评论功能快速启动.md](./评论功能快速启动.md)
- [评论功能配置指南.md](./评论功能配置指南.md)
- [评论功能测试指南.md](./评论功能测试指南.md)
- [评论功能实现总结.md](./评论功能实现总结.md)

---

**部署日期**: _______________  
**部署人员**: _______________  
**部署状态**: ✅ 成功 / ❌ 失败
