# ESä¸­åˆ†è¯å™¨ç»„æˆæ•…äº‹ç‰ˆ

> # åˆ†è¯å™¨çš„ç»„æˆ
>
> ## **Character Filter**
>
> åˆ†è¯ä¹‹å‰çš„é¢„å¤„ç†ï¼Œè¿‡æ»¤æ— ç”¨å­—ç¬¦
>
> ```
> PUT <index_name>
> {
>   "settings": {
>     "analysis": {
>       "char_filter": {
>         "my_char_filter": {
>           "type": "<value>"  // å‚æ•° type: html_stripã€mappingã€pattern_replace
>         }
>       }
>     }
>   }
> }
> ```
>
> ### HTML æ ‡ç­¾è¿‡æ»¤å™¨
>
> å­—ç¬¦è¿‡æ»¤å™¨ä¼šå»é™¤ HTML æ ‡ç­¾å’Œè½¬ä¹‰ HTML å…ƒç´ ï¼Œå¦‚ <b>ã€&amp;
>
> ```
> PUT test_char_filter
> {
>   "settings": {
>     "analysis": {
>       "char_filter": {
>         "my_char_filter": {
>           "type": "html_strip", 
>           "escaped_tags": [
>             "a"
>           ]
>         }
>       }
>     }
>   }
> }
> GET test_html_strip_filter/_analyze
> {
>   "tokenizer": "standard", 
>   "char_filter": ["my_char_filter"],
>   "text": ["<p>I'm so <a>happy</a>!</p>"]
> }
> ```
>
> **å‚æ•°ï¼š**
>
> * escaped_tagsï¼šéœ€è¦ä¿ç•™çš„ html æ ‡ç­¾
>
> ###  å­—ç¬¦æ˜ å°„è¿‡æ»¤å™¨ï¼šMapping Character Filter
>
> **é€šè¿‡å®šä¹‰æ˜ æ›¿æ¢ä¸ºè§„åˆ™ï¼ŒæŠŠç‰¹å®šå­—ç¬¦æ›¿æ¢ä¸ºæŒ‡å®šå­—ç¬¦**
>
> ```
> PUT test_html_strip_filter
> {
>   "settings": {
>     "analysis": {
>       "char_filter": {
>         "my_char_filter": {
>           "type": "mapping",	// mapping ä»£è¡¨ä½¿ç”¨å­—ç¬¦æ˜ å°„è¿‡æ»¤å™¨
>           "mappings": [				// æ•°ç»„ä¸­è§„å®šçš„å­—ç¬¦ä¼šè¢«ç­‰ä»·æ›¿æ¢ä¸º => æŒ‡å®šçš„å­—ç¬¦
>             "æ»š => *",
>             "åƒ => *",
>             "åœ¾ => *"
>           ]
>         }
>       }
>     }
>   }
> }
> GET test_html_strip_filter/_analyze
> {
>   //"tokenizer": "standard", 
>   "char_filter": ["my_char_filter"],
>   "text": "ä½ å°±æ˜¯ä¸ªåƒåœ¾ï¼æ»š"
> }
> ```
>
> ### æ­£åˆ™æ›¿æ¢è¿‡æ»¤å™¨ï¼šPattern Replace Character Filter
>
> ```
> PUT text_pattern_replace_filter
> {
>   "settings": {
>     "analysis": {
>       "char_filter": {
>         "my_char_filter": {
>           "type": "pattern_replace",	// pattern_replace ä»£è¡¨ä½¿ç”¨æ­£åˆ™æ›¿æ¢è¿‡æ»¤å™¨
>           "pattern": """(\d{3})\d{4}(\d{4})""",	// æ­£åˆ™è¡¨è¾¾å¼
>           "replacement": "$1****$2"
>         }
>       }
>     }
>   }
> }
> GET text_pattern_replace_filter/_analyze
> {
>   "char_filter": ["my_char_filter"],
>   "text": "æ‚¨çš„æ‰‹æœºå·æ˜¯18868686688"
> }
> ```
>
> ## Tokenizer
>
> **å¯ä»¥æŠŠåˆ‡è¯å™¨ç†è§£ä¸ºé¢„å®šä¹‰çš„åˆ‡è¯è§„åˆ™ã€‚**
>
> **å®˜æ–¹å†…ç½®äº†å¾ˆå¤šç§åˆ‡è¯å™¨ï¼Œé»˜è®¤çš„åˆ‡è¯å™¨ä¸º standardã€‚**
>
> åœ¨ Elasticsearch (ES) ä¸­ï¼ŒTokenizer æ˜¯ä¸€ç§æ–‡æœ¬å¤„ç†ç»„ä»¶ï¼Œç”¨äºå°†è¾“å…¥çš„æ–‡æœ¬æ•°æ®åˆ†å‰²æˆç§°ä¸ºè¯æ±‡å•å…ƒï¼ˆTokensï¼‰çš„ç‰‡æ®µã€‚Tokenizer åœ¨æ–‡æœ¬åˆ†æè¿‡ç¨‹ä¸­èµ·åˆ°äº†å…³é”®çš„ä½œç”¨ï¼Œå®ƒå°†æ–‡æœ¬è½¬æ¢ä¸ºå¯ä¾›ç´¢å¼•å’Œæœç´¢çš„åŸºæœ¬å•ä½ã€‚
>
> ES æä¾›äº†å¤šç§å†…ç½®çš„ Tokenizerï¼Œæ¯ç§ Tokenizer éƒ½æœ‰ä¸åŒçš„åˆ†å‰²è§„åˆ™ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ Tokenizer ç¤ºä¾‹ï¼š
>
> 1. Standard Tokenizerï¼ˆæ ‡å‡†åˆ†è¯å™¨ï¼‰ï¼š
>    * è¿™æ˜¯ ES é»˜è®¤çš„ Tokenizerï¼Œå®ƒä½¿ç”¨ Unicode æ–‡æœ¬åˆ†å‰²ç®—æ³•å°†æ–‡æœ¬åˆ†å‰²æˆå•ä¸ªè¯æ±‡å•å…ƒã€‚å®ƒä¼šå»é™¤æ ‡ç‚¹ç¬¦å·å’Œç©ºæ ¼ï¼Œå¹¶å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™å½¢å¼ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡æœ¬ "Hello, World!" ä¼šè¢«åˆ†å‰²æˆä¸¤ä¸ªè¯æ±‡å•å…ƒ "hello" å’Œ "world"ã€‚
> 2. Whitespace Tokenizerï¼ˆç©ºæ ¼åˆ†è¯å™¨ï¼‰ï¼š
>    * è¿™ä¸ª Tokenizer æ ¹æ®ç©ºæ ¼å­—ç¬¦å°†æ–‡æœ¬åˆ†å‰²ä¸ºè¯æ±‡å•å…ƒã€‚å®ƒä¿ç•™ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·ï¼Œä¸åšå¤§å°å†™è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡æœ¬ "Hello, World!" ä¼šè¢«åˆ†å‰²æˆä¸‰ä¸ªè¯æ±‡å•å…ƒ "Hello,"ã€"World!" å’Œ ""ï¼ˆç©ºå­—ç¬¦ï¼‰ã€‚
> 3. Keyword Tokenizerï¼ˆå…³é”®å­—åˆ†è¯å™¨ï¼‰ï¼š
>    * è¿™ä¸ª Tokenizer å°†æ•´ä¸ªè¾“å…¥ä½œä¸ºå•ä¸ªè¯æ±‡å•å…ƒã€‚å®ƒé€šå¸¸ç”¨äºä¸éœ€è¦å¯¹è¾“å…¥è¿›è¡Œåˆ†è¯çš„åœºæ™¯ï¼Œå¦‚ç²¾ç¡®åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡æœ¬ "Hello, World!" ä¼šä½œä¸ºä¸€ä¸ªå®Œæ•´çš„è¯æ±‡å•å…ƒå­˜å‚¨ã€‚
> 4. Pattern Tokenizerï¼ˆæ¨¡å¼åˆ†è¯å™¨ï¼‰ï¼š
>    * è¿™ä¸ª Tokenizer æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼å°†æ–‡æœ¬åˆ†å‰²ä¸ºè¯æ±‡å•å…ƒã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå®šä¹‰çš„æ¨¡å¼å®šä¹‰å¦‚ä½•åˆ†å‰²æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æ¨¡å¼ `\W+`ï¼Œè¾“å…¥æ–‡æœ¬ "Hello, World!" ä¼šè¢«åˆ†å‰²æˆä¸¤ä¸ªè¯æ±‡å•å…ƒ "Hello" å’Œ "World"ã€‚
> 5. Language-specific Tokenizersï¼ˆç‰¹å®šè¯­è¨€åˆ†è¯å™¨ï¼‰ï¼š
>    * ES è¿˜æä¾›äº†é’ˆå¯¹ç‰¹å®šè¯­è¨€çš„ Tokenizerï¼Œå¦‚è‹±è¯­ã€ä¸­æ–‡ã€æ—¥è¯­ç­‰ã€‚è¿™äº›åˆ†è¯å™¨ä¼šæ ¹æ®ç‰¹å®šçš„è¯­è¨€è§„åˆ™å’Œè¯­æ³•è¿›è¡Œåˆ†è¯ã€‚ä¾‹å¦‚ï¼Œä¸­æ–‡åˆ†è¯å™¨ä¼šå°†ä¸­æ–‡æ–‡æœ¬æŒ‰ç…§è¯è¯­è¿›è¡Œåˆ†å‰²ã€‚
>
> è¿™äº›ç¤ºä¾‹åªæ˜¯ ES ä¸­ä¸€äº›å¸¸è§çš„ Tokenizerï¼Œä½ è¿˜å¯ä»¥è‡ªå®šä¹‰ Tokenizer æ¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚Tokenizer æ˜¯ ES ä¸­æ–‡æœ¬å¤„ç†æµç¨‹çš„å…³é”®ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒçš„é€‰æ‹©å’Œé…ç½®å¯¹äºç´¢å¼•å’Œæœç´¢çš„ç»“æœå½±å“é‡å¤§ã€‚æ ¹æ®ä½ çš„æ•°æ®å’Œéœ€æ±‚ï¼Œé€‰æ‹©é€‚åˆçš„ Tokenizer å¯ä»¥æé«˜æœç´¢çš„å‡†ç¡®æ€§å’Œæ€§èƒ½ã€‚
>
> ## Token Filter
>
> ### ä½œç”¨
>
> åœ¨ Elasticsearch (ES) ä¸­ï¼ŒToken Filter æ˜¯ä¸€ç§æ–‡æœ¬å¤„ç†ç»„ä»¶ï¼Œç”¨äºå¯¹ Tokenizer åˆ†å‰²å¾—åˆ°çš„è¯æ±‡å•å…ƒè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†å’Œä¿®æ”¹ã€‚Token Filter å¯ä»¥ä¿®æ”¹ã€åˆ é™¤æˆ–æ·»åŠ æ–°çš„è¯æ±‡å•å…ƒï¼Œä»¥æ”¹å–„ç´¢å¼•å’Œæœç´¢çš„æ•ˆæœã€‚
>
> åœ¨ Elasticsearch çš„æŸ¥è¯¢ DSL (Domain Specific Language) ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½® Token Filter æ¥å®šä¹‰å¦‚ä½•å¤„ç†å’Œä¿®æ”¹æ–‡æœ¬æ•°æ®ã€‚
>
> ### å¸¸è§çš„ token filter
>
> * `synonym`ï¼šç”¨äºå°†æŒ‡å®šçš„è¯æ±‡æ›¿æ¢ä¸ºå…¶åŒä¹‰è¯ã€‚è¿™å¯¹äºæ‰©å±•æœç´¢èƒ½åŠ›æˆ–çº æ­£æ‹¼å†™é”™è¯¯å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå°† "car" æ›¿æ¢ä¸º "automobile"ã€‚
> * `ngram`ï¼šå°†è¯æ±‡å•å…ƒæ‹†åˆ†æˆ n-gramï¼ˆè¿ç»­çš„ n ä¸ªå­—ç¬¦ï¼‰ï¼Œç”¨äºæ”¯æŒéƒ¨åˆ†åŒ¹é…å’Œæ¨¡ç³Šæœç´¢ã€‚ä¾‹å¦‚ï¼Œ"quick" å¯ä»¥æ‹†åˆ†æˆ "qu"ã€"qui"ã€"quic"ã€"quick"ã€‚
> * `stemmer`ï¼šåº”ç”¨è¯å¹²æå–ç®—æ³•ï¼Œå°†å•è¯è¿˜åŸä¸ºå…¶è¯å¹²å½¢å¼ã€‚ä¾‹å¦‚ï¼Œå°† "running" è¿˜åŸä¸º "run"ã€‚
> * `stop`ï¼šç§»é™¤åœç”¨è¯ï¼Œè¿™äº›è¯åœ¨æœç´¢ä¸­å¾€å¾€æ²¡æœ‰å®é™…æ„ä¹‰æˆ–é¢‘ç¹å‡ºç°ã€‚ä¾‹å¦‚ï¼Œ"the"ã€"is"ã€"and"ã€‚
> * `trim`ï¼šä¿®å‰ªè¯æ±‡å•å…ƒçš„å‰å¯¼å’Œå°¾éšç©ºæ ¼ã€‚
> * `phonetic`ï¼šç”ŸæˆéŸ³è¯‘ä»£ç ï¼Œç”¨äºæ”¯æŒéŸ³è¯‘æœç´¢ã€‚ä¾‹å¦‚ï¼Œå°† "Smith" è½¬æ¢ä¸º "SM0".
>
> ### æ¡ˆä¾‹
>
> ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ Token Filterï¼š
>
> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç´¢å¼•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º "description" çš„å­—æ®µï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨ Token Filter å¯¹è¾“å…¥çš„æŸ¥è¯¢æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚
>
> ```
> PUT stop_token_filter
> {
>   "settings": {
>     "analysis": {
>       "filter": {
>         "my_filter": {
>           "type": "stop",
>           "stopwords": [
>             "www"
>           ],
>           "ignore_case": true
>         }
>       }
>     }
>   }
> }
> GET stop_token_filter/_analyze
> {
>   "tokenizer": "whitespace", 
>   "filter": ["my_filter"], 
>   "text": ["WWW ELASTIC ORG CN"]
> }
> ```
>



# **åˆ†è¯å™¨ä¸‰å‰‘å®¢ï¼šæ–‡å­—å¨æˆ¿çš„ã€Œé£ŸæåŠ å·¥æµæ°´çº¿ã€ğŸ­ğŸ”ªğŸ§‚**

æƒ³è±¡æ•°å­—æ‘çš„æ–‡å­—å¨æˆ¿é‡Œæœ‰ä¸€æ¡**æ™ºèƒ½é£ŸæåŠ å·¥æµæ°´çº¿**ï¼Œä»»ä½•æ–‡æœ¬é£Ÿæéƒ½è¦ç»è¿‡ä¸‰ä¸ªè½¦é—´çš„ç²¾å¯†å¤„ç†ï¼Œæ‰èƒ½å˜æˆç¾å‘³çš„æœç´¢ä½³è‚´ï¼

---

## **æ•…äº‹ï¼šæ–‡å­—å¨æˆ¿çš„ä¸‰è½¦é—´æµæ°´çº¿**

### **ç¬¬ä¸€è½¦é—´ï¼šé£Ÿææ¸…æ´—è½¦é—´ï¼ˆCharacter Filterï¼‰ğŸš¿**

è¿™ä¸ªè½¦é—´è´Ÿè´£**æ¸…æ´—é£Ÿææ‚è´¨**ï¼Œç¡®ä¿è¿›å…¥åˆ‡èœæœºçš„é£Ÿæå¹²å‡€å«ç”Ÿï¼

#### **1.1 HTMLæ ‡ç­¾æ¸…æ´—æœº**
```json
"char_filter": {
  "my_char_filter": {
    "type": "html_strip",      // ä¸“ç”¨HTMLæ¸…æ´—æœº
    "escaped_tags": ["a"]      // ç‰¹åˆ«ä¿ç•™<a>æ ‡ç­¾
  }
}
```

**å·¥ä½œæ•ˆæœï¼š**
```text
è¾“å…¥ï¼š<p>I'm so <a>happy</a>!</p>
â†“ æ¸…æ´—å»é™¤<p>ã€</p>ç­‰æ ‡ç­¾
è¾“å‡ºï¼šI'm so <a>happy</a>!
```

**æ£€æµ‹ç»“æœï¼š**
```json
GET test_char_filter/_analyze
{
  "tokenizer": "standard", 
  "char_filter": ["my_char_filter"],
  "text": ["<p>I'm so <a>happy</a>!</p>"]
}
// è¾“å‡ºï¼š["I'm", "so", "<a>happy</a>"]
```

#### **1.2 æ•æ„Ÿè¯æ›¿æ¢æœºï¼ˆMapping Filterï¼‰ğŸ”¤**
```json
"char_filter": {
  "my_char_filter": {
    "type": "mapping",
    "mappings": [
      "æ»š => *",    // æŠŠ"æ»š"æ›¿æ¢æˆ*
      "åƒ => *",    // æŠŠ"åƒ"æ›¿æ¢æˆ*  
      "åœ¾ => *"     // æŠŠ"åœ¾"æ›¿æ¢æˆ*
    ]
  }
}
```

**å·¥ä½œæ•ˆæœï¼š**
```text
è¾“å…¥ï¼š"ä½ å°±æ˜¯ä¸ªåƒåœ¾ï¼æ»š"
â†“ æ•æ„Ÿè¯æ›¿æ¢
è¾“å‡ºï¼š"ä½ å°±æ˜¯ä¸ª***ï¼*"
```

#### **1.3 éšç§è„±æ•æœºï¼ˆPattern Replaceï¼‰ğŸ”’**
```json
"char_filter": {
  "my_char_filter": {
    "type": "pattern_replace",
    "pattern": """(\d{3})\d{4}(\d{4})""",  // æ‰‹æœºå·æ­£åˆ™
    "replacement": "$1****$2"              // ä¸­é—´4ä½æ‰“ç 
  }
}
```

**å·¥ä½œæ•ˆæœï¼š**
```text
è¾“å…¥ï¼š"æ‚¨çš„æ‰‹æœºå·æ˜¯18868686688"
â†“ éšç§è„±æ•
è¾“å‡ºï¼š"æ‚¨çš„æ‰‹æœºå·æ˜¯188****6688"
```

---

## **ç¬¬äºŒè½¦é—´ï¼šç²¾å‡†åˆ‡èœè½¦é—´ï¼ˆTokenizerï¼‰ğŸ”ª**

è¿™ä¸ªè½¦é—´è´Ÿè´£**æŠŠæ¸…æ´—åçš„é£Ÿæåˆ‡æˆæ ‡å‡†è¯å—**ï¼Œä¸åŒçš„åˆ‡èœæœºæœ‰ä¸åŒçš„åˆ€æ³•ï¼

### **å››å¤§ä¸»åŠ›åˆ‡èœæœº**

#### **2.1 æ ‡å‡†åˆ‡èœæœºï¼ˆStandard Tokenizerï¼‰ğŸ“**
```json
"tokenizer": "standard"
```
**åˆ€æ³•ç‰¹ç‚¹ï¼š**
- æŒ‰ç©ºæ ¼å’Œæ ‡ç‚¹åˆ‡åˆ†
- è‹±æ–‡è½¬å°å†™
- ä¸­æ–‡å•å­—åˆ‡åˆ†

**åˆ‡èœæ•ˆæœï¼š**
```text
"Hello World! ä½ å¥½ä¸–ç•Œ"
â†’ ["hello", "world", "ä½ ", "å¥½", "ä¸–", "ç•Œ"]
```

#### **2.2 ç©ºæ ¼åˆ‡èœæœºï¼ˆWhitespace Tokenizerï¼‰âœ‚ï¸**
```json
"tokenizer": "whitespace"
```
**åˆ€æ³•ç‰¹ç‚¹ï¼š**
- ä¸¥æ ¼æŒ‰ç©ºæ ¼åˆ‡åˆ†
- ä¿ç•™æ ‡ç‚¹ç¬¦å·

**åˆ‡èœæ•ˆæœï¼š**
```text
"Hello, World! 2023å¹´"
â†’ ["Hello,", "World!", "2023å¹´"]
```

#### **2.3 å…³é”®è¯æ•´å—æœºï¼ˆKeyword Tokenizerï¼‰ğŸ“¦**
```json
"tokenizer": "keyword"
```
**åˆ€æ³•ç‰¹ç‚¹ï¼š**
- ä¸åˆ‡åˆ†ï¼æ•´å—å¤„ç†
- é€‚åˆIDã€ç¼–ç ç­‰

**åˆ‡èœæ•ˆæœï¼š**
```text
"iPhone14 Pro Max"
â†’ ["iPhone14 Pro Max"]  // å®Œæ•´ä¿ç•™
```

#### **2.4 ä¸­æ–‡æ™ºèƒ½åˆ‡èœæœºï¼ˆIK Tokenizerï¼‰ğŸ¯**
```json
"tokenizer": "ik_smart"
```
**åˆ€æ³•ç‰¹ç‚¹ï¼š**
- ç†è§£ä¸­æ–‡è¯­ä¹‰
- æŒ‰è¯è¯­è€Œéå•å­—åˆ‡åˆ†

**åˆ‡èœæ•ˆæœï¼š**
```text
"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"
â†’ ["æˆ‘", "çˆ±", "åŒ—äº¬", "å¤©å®‰é—¨"]  // æ™ºèƒ½åˆ†è¯ï¼
```

---

## **ç¬¬ä¸‰è½¦é—´ï¼šè°ƒå‘³ç²¾åŠ å·¥è½¦é—´ï¼ˆToken Filterï¼‰ğŸ§‚**

è¿™ä¸ªè½¦é—´è´Ÿè´£**å¯¹åˆ‡å¥½çš„è¯å—è¿›è¡Œè°ƒå‘³å¤„ç†**ï¼Œæå‡å£æ„Ÿå’Œè¥å…»ä»·å€¼ï¼

### **äº”å¤§è°ƒå‘³å·¥è‰º**

#### **3.1 åœç”¨è¯è¿‡æ»¤å™¨ï¼ˆStop Filterï¼‰ğŸš«**
```json
"filter": {
  "my_filter": {
    "type": "stop",
    "stopwords": ["www"],     // è¿‡æ»¤"www"
    "ignore_case": true        // å¿½ç•¥å¤§å°å†™
  }
}
```

**è°ƒå‘³æ•ˆæœï¼š**
```text
è¾“å…¥ï¼š["WWW", "ELASTIC", "ORG", "CN"]
â†“ è¿‡æ»¤åœç”¨è¯
è¾“å‡ºï¼š["ELASTIC", "ORG", "CN"]
```

#### **3.2 åŒä¹‰è¯æ‰©å±•å™¨ï¼ˆSynonym Filterï¼‰ğŸ”—**
```json
"filter": {
  "synonym_filter": {
    "type": "synonym",
    "synonyms": ["æ‰‹æœº => æ™ºèƒ½æ‰‹æœº,ç§»åŠ¨ç”µè¯"]
  }
}
```

**è°ƒå‘³æ•ˆæœï¼š**
```text
è¾“å…¥ï¼š["æ‰‹æœº"]
â†“ åŒä¹‰è¯æ‰©å±•
è¾“å‡ºï¼š["æ‰‹æœº", "æ™ºèƒ½æ‰‹æœº", "ç§»åŠ¨ç”µè¯"]
```

#### **3.3 è¯å¹²æå–å™¨ï¼ˆStemmer Filterï¼‰ğŸŒ±**
```json
"filter": {
  "stemmer_filter": {
    "type": "stemmer",
    "language": "english"
  }
}
```

**è°ƒå‘³æ•ˆæœï¼š**
```text
è¾“å…¥ï¼š["running", "jumps", "happily"]
â†“ è¯å¹²æå–
è¾“å‡ºï¼š["run", "jump", "happy"]
```

#### **3.4 å¤§å°å†™ç»Ÿä¸€å™¨ï¼ˆLowercase Filterï¼‰ğŸ”¡**
```json
"filter": {
  "lowercase_filter": {
    "type": "lowercase"
  }
}
```

**è°ƒå‘³æ•ˆæœï¼š**
```text
è¾“å…¥ï¼š["Apple", "iPhone", "PRO"]
â†“ è½¬å°å†™
è¾“å‡ºï¼š["apple", "iphone", "pro"]
```

#### **3.5 N-gramåˆ‡ç‰‡æœºï¼ˆNGram Filterï¼‰ğŸ”ª**
```json
"filter": {
  "ngram_filter": {
    "type": "ngram",
    "min_gram": 2,
    "max_gram": 3
  }
}
```

**è°ƒå‘³æ•ˆæœï¼š**
```text
è¾“å…¥ï¼š["apple"]
â†“ 2-3gramåˆ‡ç‰‡
è¾“å‡ºï¼š["ap", "app", "pp", "ppl", "pl", "ple", "le"]
```

---

## **å®Œæ•´æµæ°´çº¿å®æˆ˜æ¼”ç¤º**

### **é…ç½®ä¸€æ¡æ™ºèƒ½åŠ å·¥çº¿**
```json
PUT smart_kitchen
{
  "settings": {
    "analysis": {
      // ç¬¬ä¸€è½¦é—´ï¼šæ¸…æ´—è®¾å¤‡
      "char_filter": {
        "html_cleaner": {"type": "html_strip"},
        "phone_mask": {
          "type": "pattern_replace",
          "pattern": """(\d{3})\d{4}(\d{4})""",
          "replacement": "$1****$2"
        }
      },
      
      // ç¬¬äºŒè½¦é—´ï¼šåˆ‡èœè®¾å¤‡  
      "tokenizer": {
        "chinese_chef": {"type": "ik_smart"}
      },
      
      // ç¬¬ä¸‰è½¦é—´ï¼šè°ƒå‘³è®¾å¤‡
      "filter": {
        "stop_words": {"type": "stop", "stopwords": ["çš„", "äº†"]},
        "synonyms": {
          "type": "synonym", 
          "synonyms": ["æ‰‹æœº => æ™ºèƒ½æ‰‹æœº"]
        }
      },
      
      // æ•´æ¡æµæ°´çº¿ç»„è£…
      "analyzer": {
        "my_pipeline": {
          "type": "custom",
          "char_filter": ["html_cleaner", "phone_mask"],  // å…ˆæ¸…æ´—
          "tokenizer": "chinese_chef",                    // å†åˆ‡èœ
          "filter": ["lowercase", "stop_words", "synonyms"] // åè°ƒå‘³
        }
      }
    }
  }
}
```

### **æµ‹è¯•æµæ°´çº¿æ•ˆæœ**
```json
GET smart_kitchen/_analyze
{
  "analyzer": "my_pipeline",
  "text": "<p>æˆ‘çš„æ‰‹æœºå·æ˜¯18868686688ï¼Œæˆ‘æƒ³ä¹°æ–°æ‰‹æœº</p>"
}

// åŠ å·¥ç»“æœï¼š
// 1. æ¸…æ´—ï¼šå»é™¤<p>æ ‡ç­¾ï¼Œæ‰‹æœºå·è„±æ•
// 2. åˆ‡èœï¼šä¸­æ–‡æ™ºèƒ½åˆ†è¯  
// 3. è°ƒå‘³ï¼šå»åœç”¨è¯ã€åŒä¹‰è¯æ‰©å±•
// æœ€ç»ˆï¼š["æˆ‘", "æ‰‹æœºå·", "188****6688", "æƒ³", "ä¹°", "æ–°", "æ‰‹æœº", "æ™ºèƒ½æ‰‹æœº"]
```

---

## **è®°å¿†å£è¯€**

**æ–‡å­—å¨æˆ¿ä¸‰è½¦é—´ï¼š**
1. **æ¸…æ´—è½¦é—´ï¼ˆCharacter Filterï¼‰**  
   `å»æ‚è´¨` `ä¿éšç§` `æ¢æ•æ„Ÿè¯`  
2. **åˆ‡èœè½¦é—´ï¼ˆTokenizerï¼‰**  
   `åˆ†è¯è¯­` `æŒ‰è§„åˆ™` `å»ºåŸºç¡€`  
3. **è°ƒå‘³è½¦é—´ï¼ˆToken Filterï¼‰**  
   `å»åœè¯` `æ‰©åŒä¹‰` `æè¯å¹²`  

**é»„é‡‘é…ç½®æ³•åˆ™ï¼š**
> ğŸ§¼ å…ˆæ¸…æ´— â†’ å¤„ç†HTML/æ•æ„Ÿä¿¡æ¯  
> ğŸ”ª å†åˆ‡åˆ† â†’ é€‰æ‹©åˆé€‚çš„åˆ†è¯å™¨  
> ğŸ§‚ åè°ƒå‘³ â†’ æ·»åŠ è¯­è¨€ç‰¹è‰²å¤„ç†  

è®°ä½è¿™æ¡é£ŸæåŠ å·¥æµæ°´çº¿ï¼Œä½ å°±èƒ½çƒ¹åˆ¶å‡ºæœ€ç²¾å‡†çš„æœç´¢ç››å®´ï¼ ğŸ‘¨ğŸ³ğŸ¯