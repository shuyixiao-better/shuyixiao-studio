---
layout: doc
title: ESä¸­æ˜ å°„å‚æ•°æ•…äº‹ç‰ˆ
description: è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç”ŸåŠ¨çš„æ•…äº‹æ¥ç†è§£ `index` è¿™ä¸ªé‡è¦çš„æ˜ å°„å‚æ•°ï¼
date: '2025-10-09'
tags:
  - Elasticsearch
  - Java
author: èˆ’ä¸€ç¬‘ä¸ç§ƒå¤´
---
# ESä¸­æ˜ å°„å‚æ•°æ•…äº‹ç‰ˆ

> # æ˜ å°„å‚æ•°
>
> ## index
>
> **index**ï¼šæ˜¯å¦å¯¹åˆ›å»ºå¯¹å½“å‰å­—æ®µåˆ›å»ºå€’æ’ç´¢å¼•ï¼Œé»˜è®¤ trueï¼Œå¦‚æœä¸åˆ›å»ºç´¢å¼•ï¼Œè¯¥å­—æ®µä¸ä¼šé€šè¿‡ç´¢å¼•è¢«æœç´¢åˆ°,ä½†æ˜¯ä»ç„¶ä¼šåœ¨ source å…ƒæ•°æ®ä¸­å±•ç¤º
>
> ```java
> ##index
> delete users
> PUT users
> {
>   "mappings": {
>     "properties": {
>       "age":{
>         "type": "integer",
>         "index": false
>       }
>     }
>   }
> }
> 
> PUT users/_doc/1
> {
>   "age":99
> }
> 
> GET users/_search
> {
>   "query": {
>     "term": {
>       "age": 99
>     }
>   }
> }
> ```
>
# **æ˜ å°„å‚æ•° indexï¼šæ•°å­—æ‘çš„"ç”µè¯ç°¿ç™»è®°å¤„" ğŸ“**

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç”ŸåŠ¨çš„æ•…äº‹æ¥ç†è§£ `index` è¿™ä¸ªé‡è¦çš„æ˜ å°„å‚æ•°ï¼

## **æ•…äº‹ï¼šæ•°å­—æ‘çš„ç”µè¯ç°¿ç³»ç»Ÿ**

æƒ³è±¡æ•°å­—æ‘æœ‰ä¸€ä¸ª**ç”µè¯ç°¿ç®¡ç†å‘˜**ï¼Œä»–çš„å·¥ä½œæ˜¯ç»´æŠ¤å…¨æ‘äººçš„è”ç³»æ–¹å¼ã€‚ä½†è¿™ä¸ªç®¡ç†å‘˜æœ‰ä¸ªç‰¹æ®Šè§„åˆ™ï¼š**åªæœ‰åœ¨ä»–é‚£é‡Œç™»è®°è¿‡çš„äººï¼Œæ‰èƒ½è¢«å…¶ä»–äººé€šè¿‡ç”µè¯ç°¿æ‰¾åˆ°**ã€‚

### **1. é»˜è®¤æƒ…å†µï¼šè‡ªåŠ¨ç™»è®°ï¼ˆindex: trueï¼‰**

æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–°æ‘æ°‘çš„ç”µè¯éƒ½ä¼š**è‡ªåŠ¨ç™»è®°**åˆ°ç”µè¯ç°¿ä¸­ï¼š

```json
PUT villagers
{
  "mappings": {
    "properties": {
      "name": {"type": "text"},    // è‡ªåŠ¨ç™»è®°åˆ°ç”µè¯ç°¿
      "phone": {"type": "keyword"}  // è‡ªåŠ¨ç™»è®°åˆ°ç”µè¯ç°¿
    }
  }
}
```

**ç»“æœï¼š**
- ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡ç”µè¯ç°¿æŸ¥æ‰¾æ‘æ°‘
- æœç´¢ `"å¼ ä¸‰"` æˆ– `"13800138000"` éƒ½èƒ½æ‰¾åˆ°å¯¹åº”çš„äºº

### **2. ç‰¹æ®Šè®¾ç½®ï¼šéšç§ä¿æŠ¤æ¨¡å¼ï¼ˆindex: falseï¼‰**

ç°åœ¨æœ‰ä¸ªæ‘æ°‘**ç‹äº”**ï¼Œä»–å¾ˆæ³¨é‡éšç§ï¼Œä¸å¸Œæœ›è‡ªå·±çš„ç”µè¯è¢«ç™»è®°åœ¨å…¬å…±ç”µè¯ç°¿ä¸Šï¼š

```json
PUT users
{
  "mappings": {
    "properties": {
      "age": {
        "type": "integer",
        "index": false  // å‘Šè¯‰ç®¡ç†å‘˜ï¼šåˆ«ç™»è®°è¿™ä¸ªï¼
      }
    }
  }
}
```

**ç‹äº”çš„æƒ³æ³•ï¼š**
- "æˆ‘çš„å¹´é¾„æ˜¯**éšç§ä¿¡æ¯**ï¼Œä¸æƒ³è®©åˆ«äººé€šè¿‡å¹´é¾„æœåˆ°æˆ‘"
- "ä½†å½“æˆ‘å±•ç¤ºä¸ªäººèµ„æ–™æ—¶ï¼Œå¹´é¾„**å¯ä»¥æ˜¾ç¤º**"

### **3. å®é™…æ“ä½œæ¼”ç¤º**

#### **æ­¥éª¤1ï¼šåˆ›å»ºéšç§ä¿æŠ¤çš„æ¡£æ¡ˆç³»ç»Ÿ**
```json
DELETE users

PUT users
{
  "mappings": {
    "properties": {
      "age": {
        "type": "integer",
        "index": false  // å¹´é¾„ä¸åŠ å…¥"ç”µè¯ç°¿"
      }
    }
  }
}
```

#### **æ­¥éª¤2ï¼šå­˜å…¥ç‹äº”çš„æ¡£æ¡ˆ**
```json
PUT users/_doc/1
{
  "age": 99
}
```

#### **æ­¥éª¤3ï¼šå°è¯•é€šè¿‡å¹´é¾„æœç´¢ï¼ˆå¤±è´¥ï¼ï¼‰**
```json
GET users/_search
{
  "query": {
    "term": {
      "age": 99  // è¯•å›¾é€šè¿‡å¹´é¾„99å²æ¥æ‰¾äºº
    }
  }
}
```

**ç»“æœï¼š** æœç´¢è¿”å› **0 ä¸ªç»“æœ**ï¼
- ğŸ” **æœç´¢å¤±è´¥åŸå› **ï¼šå¹´é¾„å­—æ®µæ²¡æœ‰åŠ å…¥"ç”µè¯ç°¿"ï¼ˆå€’æ’ç´¢å¼•ï¼‰
- ğŸ“ **ç®¡ç†å‘˜å›åº”**ï¼š"æŠ±æ­‰ï¼Œç”µè¯ç°¿é‡Œæ²¡æœ‰ç™»è®°å¹´é¾„ä¿¡æ¯ï¼Œæˆ‘æ— æ³•å¸®ä½ æŸ¥æ‰¾"

#### **æ­¥éª¤4ï¼šä½†ä¿¡æ¯ç¡®å®å­˜å‚¨äº†ï¼**
```json
GET users/_doc/1
```

**è¿”å›ç»“æœï¼š**
```json
{
  "_index": "users",
  "_id": "1",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "found": true,
  "_source": {
    "age": 99  // å¹´é¾„ä¿¡æ¯ç¡®å®å­˜åœ¨ï¼
  }
}
```

âœ… **ä¿¡æ¯å®‰å…¨å­˜å‚¨**ï¼šå¹´é¾„99å²è¿™ä¸ªä¿¡æ¯ç¡®å®ä¿å­˜åœ¨æ¡£æ¡ˆé‡Œï¼Œåªæ˜¯ä¸èƒ½é€šè¿‡æœç´¢æ‰¾åˆ°

---

## **æ·±å…¥ç†è§£ï¼šindex å‚æ•°çš„ä¸¤ç§æ¨¡å¼**

### **æ¨¡å¼1ï¼šå…¬å¼€ç™»è®°ï¼ˆindex: trueï¼‰âœ…**
```json
"phone": {
  "type": "keyword",
  "index": true  // é»˜è®¤å€¼ï¼Œå¯ä»¥çœç•¥
}
```
- **æ¯”å–»**ï¼šç”µè¯ç™»è®°åœ¨å…¬å…±ç”µè¯ç°¿ä¸Š
- **æ•ˆæœ**ï¼šå¯ä»¥é€šè¿‡ `13800138000` æœç´¢åˆ°è¿™ä¸ªäºº
- **ä½¿ç”¨åœºæ™¯**ï¼šéœ€è¦è¢«æœç´¢çš„å­—æ®µï¼ˆå§“åã€æ ‡é¢˜ã€æ ‡ç­¾ç­‰ï¼‰

### **æ¨¡å¼2ï¼šéšç§ä¿æŠ¤ï¼ˆindex: falseï¼‰ğŸš«**
```json
"age": {
  "type": "integer", 
  "index": false  // æ˜ç¡®å£°æ˜ä¸ç´¢å¼•
}
```
- **æ¯”å–»**ï¼šç”µè¯**ä¸ç™»è®°**åœ¨å…¬å…±ç”µè¯ç°¿ä¸Š
- **æ•ˆæœ**ï¼š**æ— æ³•**é€šè¿‡å¹´é¾„æœç´¢åˆ°è¿™ä¸ªäºº
- **ä½¿ç”¨åœºæ™¯**ï¼šæ•æ„Ÿä¿¡æ¯ã€ä»…ç”¨äºå±•ç¤ºçš„å­—æ®µã€å¤§æ–‡æœ¬å†…å®¹ç­‰

---

## **å®é™…åº”ç”¨åœºæ™¯**

### **åœºæ™¯1ï¼šä¿æŠ¤ç”¨æˆ·éšç§**
```json
PUT user_profiles
{
  "mappings": {
    "properties": {
      "user_id": {"type": "keyword"},      // å¯æœç´¢
      "email": {"type": "keyword"},         // å¯æœç´¢  
      "id_card": {
        "type": "keyword",
        "index": false  // èº«ä»½è¯å·ä¸å…æœç´¢ï¼
      },
      "phone": {
        "type": "keyword", 
        "index": false  // æ‰‹æœºå·ä¸å…è®¸æœç´¢ï¼
      }
    }
  }
}
```

### **åœºæ™¯2ï¼šä¼˜åŒ–å­˜å‚¨æ€§èƒ½**
```json
PUT articles
{
  "mappings": {
    "properties": {
      "title": {"type": "text"},          // éœ€è¦æœç´¢
      "content": {
        "type": "text",
        "index": false  // æ–‡ç« å†…å®¹å¤ªå¤§ï¼Œä¸å»ºç´¢å¼•èŠ‚çœç©ºé—´
      },
      "html_content": {
        "type": "text", 
        "index": false  // HTMLæºç ä¸éœ€è¦æœç´¢
      }
    }
  }
}
```

### **åœºæ™¯3ï¼šç»„åˆä½¿ç”¨ç¤ºä¾‹**
```json
PUT products
{
  "mappings": {
    "properties": {
      "product_id": {"type": "keyword"},    // å¯æœç´¢
      "product_name": {"type": "text"},      // å¯æœç´¢
      "description": {"type": "text"},      // å¯æœç´¢
      "internal_notes": {                   // å†…éƒ¨å¤‡æ³¨ï¼Œä¸æœç´¢
        "type": "text",
        "index": false
      },
      "image_base64": {                    // Base64å›¾ç‰‡ï¼Œä¸æœç´¢
        "type": "binary",
        "index": false
      },
      "create_time": {"type": "date"},     // å¯æœç´¢ã€å¯æ’åº
      "update_time": {                     // ä»…è®°å½•ï¼Œä¸æœç´¢
        "type": "date", 
        "index": false
      }
    }
  }
}
```

---

## **é‡è¦æ³¨æ„äº‹é¡¹**

### **1. index: false ä¸ç­‰äºä¸å­˜å‚¨**
```json
// é”™è¯¯ç†è§£ï¼šè®¾ç½®äº† index: false æ•°æ®å°±ä¸¢äº†ï¼Ÿ
// æ­£ç¡®ç†è§£ï¼šæ•°æ®æ­£å¸¸å­˜å‚¨ï¼Œåªæ˜¯ä¸èƒ½é€šè¿‡è¿™ä¸ªå­—æ®µæœç´¢

GET users/_doc/1
// ä»ç„¶èƒ½çœ‹åˆ°ï¼š{"age": 99} - æ•°æ®å®Œå¥½æ— æŸï¼
```

### **2. ä¸ enabled å‚æ•°çš„åŒºåˆ«**
```json
"age": {
  "type": "integer",
  "index": false    // å¯å­˜å‚¨ï¼Œä¸å¯æœç´¢
}

"metadata": {
  "enabled": false  // å®Œå…¨å¿½ç•¥ï¼Œä¸å­˜å‚¨ä¸æœç´¢
}
```

### **3. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å»ºè®®**
```json
PUT best_practice
{
  "mappings": {
    "properties": {
      // éœ€è¦æœç´¢çš„å­—æ®µ
      "searchable_field": {"type": "text"},
      
      // æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
      "sensitive_data": {
        "type": "keyword",
        "index": false
      },
      
      // å¤§å†…å®¹ä¼˜åŒ–
      "large_content": {
        "type": "text", 
        "index": false
      },
      
      // ä»…ç”¨äºå±•ç¤ºçš„å­—æ®µ
      "display_only": {
        "type": "keyword",
        "index": false
      }
    }
  }
}
```

## **è®°å¿†å£è¯€**

**indexå‚æ•°å¾ˆç®€å•ï¼Œå°±åƒç”µè¯ç°¿ç™»è®°ï¼š**
- **index: true** â†’ **å…¬å¼€ç™»è®°**ï¼Œå¤§å®¶éƒ½èƒ½æœåˆ°
- **index: false** â†’ **éšç§ä¿æŠ¤**ï¼Œå­˜å‚¨ä½†ä¸è®©æœ
- **é»˜è®¤éƒ½æ˜¯ true** â†’ è‡ªåŠ¨ç™»è®°ï¼Œæ–¹ä¾¿æœç´¢
- **æ•æ„Ÿå¤§æ•°æ®** â†’ è®¾ä¸ºfalseï¼Œå®‰å…¨åˆçœç©ºé—´

è®°ä½è¿™ä¸ªç”µè¯ç°¿çš„æ¯”å–»ï¼Œä½ å°±èƒ½è½»æ¾æŒæ¡ index å‚æ•°çš„ç²¾é«“äº†ï¼ğŸ“šâœ¨
