# 评论功能测试指南

## 🧪 测试前准备

### 1. 本地测试环境

```bash
# 1. 配置环境变量
cp .env.example .env

# 2. 编辑 .env 文件，填入真实配置
# SMTP_HOST=smtp.163.com
# SMTP_PORT=465
# SMTP_USER=your-email@163.com
# SMTP_PASS=your-authorization-password
# ADMIN_EMAIL=your-email@163.com
# ADMIN_PASSWORD=test123456

# 3. 启动 Netlify Dev
pnpm docs:dev:netlify

# 4. 访问 http://localhost:8888
```

### 2. Netlify 测试环境

1. 登录 [Netlify](https://app.netlify.com/)
2. 进入站点设置
3. 配置环境变量（见下方）
4. 触发重新部署
5. 访问你的 Netlify 站点

**环境变量配置**:
```
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_USER=your-email@163.com
SMTP_PASS=your-authorization-password
ADMIN_EMAIL=your-email@163.com
ADMIN_PASSWORD=your-strong-password
```

## ✅ 功能测试清单

### 测试 1: 发表文字评论

**步骤**:
1. 访问任意文章页面
2. 滚动到页面底部
3. 在"您的昵称"输入框输入: `测试用户`
4. 在评论框输入: `这是一条测试评论`
5. 点击"发表评论"按钮

**预期结果**:
- ✅ 显示"评论发表成功！"提示
- ✅ 评论立即显示在评论列表中
- ✅ 评论内容正确显示
- ✅ 时间显示为"刚刚"
- ✅ 管理员邮箱收到通知邮件

### 测试 2: 上传单张图片

**步骤**:
1. 填写昵称和评论内容
2. 点击"📷 上传图片"按钮
3. 选择一张图片（小于2MB）
4. 确认图片预览显示
5. 点击"发表评论"

**预期结果**:
- ✅ 图片预览正确显示
- ✅ 评论发表成功
- ✅ 评论中图片正确显示
- ✅ 点击图片可以放大查看

### 测试 3: 上传多张图片

**步骤**:
1. 填写昵称和评论内容
2. 点击"📷 上传图片"
3. 选择 3 张图片
4. 确认所有图片预览显示
5. 点击"发表评论"

**预期结果**:
- ✅ 3张图片都正确预览
- ✅ 评论发表成功
- ✅ 所有图片都正确显示

### 测试 4: 图片数量限制

**步骤**:
1. 尝试上传 4 张图片

**预期结果**:
- ✅ 显示"最多只能上传3张图片"提示
- ✅ 只保留前3张图片

### 测试 5: 图片大小限制

**步骤**:
1. 尝试上传一张超过 2MB 的图片

**预期结果**:
- ✅ 显示"图片超过2MB，请压缩后上传"提示
- ✅ 图片不会被添加

### 测试 6: 删除图片预览

**步骤**:
1. 上传 2 张图片
2. 点击第一张图片右上角的 × 按钮

**预期结果**:
- ✅ 第一张图片被移除
- ✅ 只剩下第二张图片

### 测试 7: 输入长度限制

**步骤**:
1. 昵称输入框输入超过 20 个字符
2. 评论框输入超过 500 个字符

**预期结果**:
- ✅ 昵称最多显示 20 个字符
- ✅ 评论最多显示 500 个字符

### 测试 8: 必填项验证

**步骤**:
1. 只填写昵称，不填写评论内容
2. 点击"发表评论"

**预期结果**:
- ✅ 显示"请填写昵称和评论内容"提示
- ✅ 评论不会被提交

### 测试 9: 删除评论（正确密码）

**步骤**:
1. 按住键盘 `Shift` 键 3 秒
2. 观察评论右侧出现 🗑️ 按钮
3. 点击删除按钮
4. 输入正确的管理员密码
5. 点击确定

**预期结果**:
- ✅ 显示"评论已删除"提示
- ✅ 评论从列表中消失

### 测试 10: 删除评论（错误密码）

**步骤**:
1. 按住 `Shift` 键 3 秒
2. 点击删除按钮
3. 输入错误的密码
4. 点击确定

**预期结果**:
- ✅ 显示"删除失败：密码错误"提示
- ✅ 评论仍然存在

### 测试 11: 图片预览功能

**步骤**:
1. 点击评论中的图片

**预期结果**:
- ✅ 图片在黑色背景中放大显示
- ✅ 点击背景或图片可以关闭预览

### 测试 12: 时间显示

**步骤**:
1. 发表一条评论
2. 观察时间显示

**预期结果**:
- ✅ 刚发表显示"刚刚"
- ✅ 1分钟后显示"1分钟前"
- ✅ 1小时后显示"1小时前"
- ✅ 1天后显示"1天前"

### 测试 13: 邮件通知

**步骤**:
1. 发表一条评论
2. 检查管理员邮箱

**预期结果**:
- ✅ 收到邮件通知
- ✅ 邮件包含文章路径
- ✅ 邮件包含评论者昵称
- ✅ 邮件包含评论内容
- ✅ 邮件包含评论图片（如有）
- ✅ 邮件包含查看链接

### 测试 14: 多篇文章评论隔离

**步骤**:
1. 在文章 A 发表评论
2. 在文章 B 发表评论
3. 返回文章 A 查看

**预期结果**:
- ✅ 文章 A 只显示 A 的评论
- ✅ 文章 B 只显示 B 的评论
- ✅ 评论不会混淆

### 测试 15: 响应式设计（移动端）

**步骤**:
1. 使用手机或浏览器开发者工具切换到移动端视图
2. 测试评论功能

**预期结果**:
- ✅ 布局适配移动端
- ✅ 按钮大小合适
- ✅ 输入框易于操作
- ✅ 图片大小适中

### 测试 16: GitHub Pages 降级提示

**步骤**:
1. 访问 GitHub Pages 版本的网站
2. 打开任意文章

**预期结果**:
- ✅ 显示评论占位组件
- ✅ 提示"当前站点为 GitHub Pages 镜像版本"
- ✅ 显示"前往 Netlify 版本评论"按钮
- ✅ 点击按钮跳转到 Netlify 版本

## 🐛 常见问题排查

### 问题 1: 评论无法加载

**排查步骤**:
1. 打开浏览器控制台查看错误
2. 检查 API 请求是否成功
3. 检查 Netlify Functions 日志
4. 确认环境变量配置正确

### 问题 2: 邮件通知未收到

**排查步骤**:
1. 检查 `ADMIN_EMAIL` 配置
2. 检查 SMTP 配置是否正确
3. 查看 Netlify Functions 日志
4. 检查邮箱垃圾箱

### 问题 3: 删除按钮不显示

**排查步骤**:
1. 确认按住 `Shift` 键至少 3 秒
2. 检查浏览器控制台是否有错误
3. 尝试刷新页面重试

### 问题 4: 图片上传失败

**排查步骤**:
1. 检查图片大小是否超过 2MB
2. 检查图片格式是否支持
3. 检查浏览器控制台错误
4. 尝试压缩图片后重试

### 问题 5: 评论提交后不显示

**排查步骤**:
1. 检查浏览器控制台错误
2. 检查 API 响应状态
3. 刷新页面查看是否已保存
4. 检查 Netlify Blobs 数据

## 📊 测试报告模板

```markdown
## 评论功能测试报告

**测试时间**: 2025-11-13
**测试环境**: Netlify / 本地开发
**测试人员**: [你的名字]

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 发表文字评论 | ✅ / ❌ | |
| 上传单张图片 | ✅ / ❌ | |
| 上传多张图片 | ✅ / ❌ | |
| 图片数量限制 | ✅ / ❌ | |
| 图片大小限制 | ✅ / ❌ | |
| 删除图片预览 | ✅ / ❌ | |
| 输入长度限制 | ✅ / ❌ | |
| 必填项验证 | ✅ / ❌ | |
| 删除评论（正确密码） | ✅ / ❌ | |
| 删除评论（错误密码） | ✅ / ❌ | |
| 图片预览功能 | ✅ / ❌ | |
| 时间显示 | ✅ / ❌ | |
| 邮件通知 | ✅ / ❌ | |
| 多篇文章隔离 | ✅ / ❌ | |
| 响应式设计 | ✅ / ❌ | |
| GitHub Pages 降级 | ✅ / ❌ | |

### 发现的问题

1. [问题描述]
2. [问题描述]

### 改进建议

1. [建议内容]
2. [建议内容]
```

## 🎯 性能测试

### 测试场景 1: 大量评论加载

**步骤**:
1. 在一篇文章下发表 50 条评论
2. 刷新页面
3. 观察加载时间

**预期**:
- 加载时间 < 2 秒

### 测试场景 2: 图片上传速度

**步骤**:
1. 上传 3 张 1.5MB 的图片
2. 观察上传和预览时间

**预期**:
- 预览显示 < 1 秒
- 提交成功 < 3 秒

## 📝 测试记录

建议在测试过程中记录：
- 测试时间
- 测试环境（浏览器、设备）
- 测试结果
- 发现的问题
- 截图或录屏

## 🚀 上线前检查清单

- [ ] 所有功能测试通过
- [ ] 邮件通知正常工作
- [ ] 移动端适配正常
- [ ] 性能测试达标
- [ ] 安全测试通过
- [ ] 环境变量配置正确
- [ ] 文档完整准确
- [ ] 备份现有数据

## 📞 技术支持

如果测试过程中遇到问题：
1. 查看浏览器控制台错误
2. 查看 Netlify Functions 日志
3. 参考配置指南文档
4. 检查环境变量配置
