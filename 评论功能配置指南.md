# 评论功能配置指南

## 功能概述

本项目为每篇文章添加了评论功能，支持：
- ✅ 文字评论
- ✅ 图片上传（最多3张，每张不超过2MB）
- ✅ 评论删除（需要管理员密码）
- ✅ 邮件通知（新评论时通知管理员）
- ✅ 响应式设计，适配移动端

## 部署说明

### Netlify 部署（完整功能）

Netlify 部署支持完整的评论功能，包括数据存储和邮件通知。

#### 1. 环境变量配置

在 Netlify 后台配置以下环境变量：

```bash
# SMTP 邮件配置（用于发送通知）
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_USER=your-email@163.com
SMTP_PASS=your-authorization-password

# 评论功能配置
ADMIN_EMAIL=your-email@163.com        # 接收评论通知的邮箱
ADMIN_PASSWORD=your-strong-password   # 删除评论的密码
```

#### 2. 配置步骤

1. 登录 [Netlify](https://app.netlify.com/)
2. 选择你的站点
3. 进入 `Site settings` → `Environment variables`
4. 点击 `Add a variable` 添加上述环境变量
5. 重新部署站点

#### 3. 数据存储

评论数据存储在 Netlify Blobs 中，无需额外配置。每篇文章的评论独立存储，按文章路径作为键值。

### GitHub Pages 部署（功能受限）

GitHub Pages 是静态托管服务，不支持服务端功能，因此：
- ❌ 评论功能不可用
- ❌ 无法存储评论数据
- ❌ 无法发送邮件通知

**建议方案：**
1. 主要使用 Netlify 部署，享受完整功能
2. GitHub Pages 作为备用镜像站点
3. 在 GitHub Pages 版本中可以添加提示，引导用户到 Netlify 版本评论

## 使用说明

### 发表评论

1. 在文章底部找到评论区
2. 填写昵称（必填，最多20字符）
3. 填写评论内容（必填，最多500字符）
4. 可选：上传图片（最多3张，每张不超过2MB）
5. 点击"发表评论"按钮

### 删除评论

删除评论需要管理员权限：

1. 按住键盘 `Shift` 键 3 秒
2. 评论右侧会出现删除按钮（🗑️）
3. 点击删除按钮
4. 输入管理员密码
5. 确认删除

### 邮件通知

当有新评论时，系统会自动发送邮件通知到 `ADMIN_EMAIL` 配置的邮箱，邮件内容包括：
- 文章标题和路径
- 评论者昵称
- 评论时间
- 评论内容
- 评论图片（如有）
- 查看评论的链接

## 本地开发测试

### 1. 配置环境变量

复制 `.env.example` 为 `.env`，填入真实配置：

```bash
cp .env.example .env
```

编辑 `.env` 文件：

```bash
# SMTP 配置
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_USER=your-email@163.com
SMTP_PASS=your-authorization-password

# 评论配置
ADMIN_EMAIL=your-email@163.com
ADMIN_PASSWORD=test123456
```

### 2. 启动开发服务器

```bash
# 使用 Netlify Dev（推荐，支持 Functions）
pnpm docs:dev:netlify

# 或使用 VitePress Dev（评论功能不可用）
pnpm docs:dev
```

### 3. 测试评论功能

1. 访问 http://localhost:8888
2. 打开任意文章页面
3. 滚动到底部测试评论功能

## 技术架构

### 前端组件

- **位置**: `docs/.vitepress/theme/components/Comments.vue`
- **功能**: 
  - 评论列表展示
  - 评论表单
  - 图片上传和预览
  - 评论删除

### 后端 API

- **位置**: `netlify/functions/comments.mjs`
- **端点**: `/.netlify/functions/comments`
- **方法**:
  - `GET`: 获取评论列表
  - `POST`: 发表评论
  - `DELETE`: 删除评论

### 数据存储

- **服务**: Netlify Blobs
- **结构**: 
  ```json
  {
    "comments": [
      {
        "id": "1234567890",
        "author": "张三",
        "content": "很棒的文章！",
        "images": ["data:image/png;base64,..."],
        "timestamp": "2025-11-13T10:30:00.000Z"
      }
    ]
  }
  ```

## 安全考虑

1. **密码保护**: 删除评论需要管理员密码
2. **输入验证**: 限制昵称和评论长度
3. **图片限制**: 限制图片数量和大小
4. **CORS 配置**: 仅允许特定域名访问
5. **XSS 防护**: 评论内容经过转义处理

## 常见问题

### Q: 为什么 GitHub Pages 不支持评论？
A: GitHub Pages 是纯静态托管，不支持服务端功能。评论需要后端 API 和数据库支持。

### Q: 评论数据会丢失吗？
A: 不会。评论存储在 Netlify Blobs 中，是持久化存储，不会丢失。

### Q: 如何备份评论数据？
A: 可以通过 Netlify CLI 导出 Blobs 数据：
```bash
netlify blobs:list comments
```

### Q: 可以使用其他评论系统吗？
A: 可以。你可以集成第三方评论系统如 Giscus、Utterances 等。

### Q: 如何修改评论样式？
A: 编辑 `Comments.vue` 组件中的 `<style>` 部分。

## 后续优化建议

1. **评论审核**: 添加评论审核机制，防止垃圾评论
2. **回复功能**: 支持评论回复，形成讨论串
3. **点赞功能**: 为评论添加点赞功能
4. **表情支持**: 支持 Emoji 表情
5. **Markdown**: 支持 Markdown 格式评论
6. **分页加载**: 评论过多时分页加载
7. **实时更新**: 使用 WebSocket 实现实时评论更新

## 相关文件

- 前端组件: `docs/.vitepress/theme/components/Comments.vue`
- 后端 API: `netlify/functions/comments.mjs`
- 主题配置: `docs/.vitepress/theme/index.js`
- 环境变量: `.env.example`

## 技术支持

如有问题，请查看：
- [VitePress 文档](https://vitepress.dev/)
- [Netlify Functions 文档](https://docs.netlify.com/functions/overview/)
- [Netlify Blobs 文档](https://docs.netlify.com/blobs/overview/)
